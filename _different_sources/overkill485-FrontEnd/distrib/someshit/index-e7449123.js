!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const e=(e,t)=>t.some((t=>e instanceof t));let t,n;const o=new WeakMap,s=new WeakMap,a=new WeakMap,r=new WeakMap,c=new WeakMap;let l={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return s.get(e);if("objectStoreNames"===t)return e.objectStoreNames||a.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return m(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function i(e){l=e(l)}function d(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(p(this),t),m(o.get(this))}:function(...t){return m(e.apply(p(this),t))}:function(t,...n){const o=e.call(p(this),t,...n);return a.set(o,t.sort?t.sort():[t]),m(o)}}function u(n){return"function"==typeof n?d(n):(n instanceof IDBTransaction&&function(e){if(s.has(e))return;const t=new Promise(((t,n)=>{const o=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",a),e.removeEventListener("abort",a)},s=()=>{t(),o()},a=()=>{n(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",s),e.addEventListener("error",a),e.addEventListener("abort",a)}));s.set(e,t)}(n),e(n,t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(n,l):n)}function m(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const o=()=>{e.removeEventListener("success",s),e.removeEventListener("error",a)},s=()=>{t(m(e.result)),o()},a=()=>{n(e.error),o()};e.addEventListener("success",s),e.addEventListener("error",a)}));return t.then((t=>{t instanceof IDBCursor&&o.set(t,e)})).catch((()=>{})),c.set(t,e),t}(e);if(r.has(e))return r.get(e);const t=u(e);return t!==e&&(r.set(e,t),c.set(t,e)),t}const p=e=>c.get(e);function b(e,t,{blocked:n,upgrade:o,blocking:s,terminated:a}={}){const r=indexedDB.open(e,t),c=m(r);return o&&r.addEventListener("upgradeneeded",(e=>{o(m(r.result),e.oldVersion,e.newVersion,m(r.transaction),e)})),n&&r.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),c.then((e=>{a&&e.addEventListener("close",(()=>a())),s&&e.addEventListener("versionchange",(e=>s(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),c}const g=["get","getKey","getAll","getAllKeys","count"],h=["put","add","delete","clear"],f=new Map;function w(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(f.get(t))return f.get(t);const n=t.replace(/FromIndex$/,""),o=t!==n,s=h.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!s&&!g.includes(n))return;const a=async function(e,...t){const a=this.transaction(e,s?"readwrite":"readonly");let r=a.store;return o&&(r=r.index(t.shift())),(await Promise.all([r[n](...t),s&&a.done]))[0]};return f.set(t,a),a}i((e=>({...e,get:(t,n,o)=>w(t,n)||e.get(t,n,o),has:(t,n)=>!!w(t,n)||e.has(t,n)})));const y=["continue","continuePrimaryKey","advance"],S={},v=new WeakMap,I=new WeakMap,T={get(e,t){if(!y.includes(t))return e[t];let n=S[t];return n||(n=S[t]=function(...e){v.set(this,I.get(this)[t](...e))}),n}};async function*E(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;const n=new Proxy(t,T);for(I.set(n,t),c.set(n,p(t));t;)yield n,t=await(v.get(n)||t.continue()),v.delete(n)}function L(t,n){return n===Symbol.asyncIterator&&e(t,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===n&&e(t,[IDBIndex,IDBObjectStore])}i((e=>({...e,get:(t,n,o)=>L(t,n)?E:e.get(t,n,o),has:(t,n)=>L(t,n)||e.has(t,n)})));const B={};let D=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||self.indexedDB;var x;B.init=async e=>{console.log("DB-init",e),"indexedDB"in window?await x(e):console.log("This browser doesn't support IndexedDB")},x=async e=>await b(e,1,{upgrade(t){const n=t.createObjectStore(e,{keyPath:"title",autoIncrement:!0});n.createIndex("title","title",{unique:!0}),n.createIndex("b64","b64",{unique:!0}),n.createIndex("dateModified","dateModified",{unique:!1})}}),B.addPublication=async(e,t,n,o)=>{console.log(e,t,n);let s=await b(t,1);return await s.get(t,e)?(await s.put(t,{title:e,blob:n,b64:o,dateModified:(new Date).getTime()}),console.log("updated"),"updated"):(await s.add(t,{title:e,blob:n,b64:o,dateModified:(new Date).getTime()}),console.log("added"),"added")},B.loadPublication=async(e,t)=>{const n=await b(t,1);return await n.get(t,e)},B.checkPublication=async(e,t)=>{const n=await b(t,1);let o,s=n.transaction(t,"readonly");try{o=await s.objectStore(t).get(e)}catch{}return n.close(),o},B.loadImage=async e=>{const t=await async function(e){return console.log("function -loader - db "+e),new Promise(((t,n)=>{let o;try{o=fetch(e,{mode:"cors"}).then((e=>e.blob())),t(o)}catch(s){console.log(s)}finally{console.log("We do cleanup here")}}))}(`${e}`);console.log("recValue ",t);let n=t;return console.log(n),{title:e,blob:n,b64:await B.convToB64(n),dateModified:(new Date).getTime()}},B.readAllDB=async e=>{const t=await b(e,1),n=await t.getAll(e);return await t.getAllKeys(e),t.close(),n},B.deletePublication=async(e,t)=>{const n=await b(e,1);let o=n.transaction(e,"readwrite");try{await o.objectStore(e).get(t);o.objectStore(e).delete(t)}catch(s){}n.close()},B.deleteDatabase=e=>{D.open(e,1);var t=D.deleteDatabase(e);t.onsuccess=function(t){console.log("Database "+e+" deleted")},console.warn(t)},B.deleteObjStore=e=>{var t=B.getObjectStore(e,"readwrite");try{t.clear()}catch(n){}},B.bmpTOblob=e=>new Promise((t=>{const n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("bitmaprenderer").transferFromImageBitmap(e),n.toBlob((e=>t(e)))})),B.convToB64=function(e){return new Promise((t=>{let n=new FileReader;n.onload=function(){t(this.result)},n.readAsDataURL(e)}))};const M={exec:e=>{const t=e.data;if(console.log("IP Messages================================================"),"IP"===t.slice(0,2)){let e=t.split("--:")[1];console.log(e.split("-:"));let n=e.split("-:");for(const t of n){console.log(t.split(":-"));let e=t.split(":-")[0],n=t.split(":-")[1];switch(e){case"softap":document.querySelector("#softIP").innerHTML=n;break;case"local":document.querySelector("#pubIP").innerHTML=n;break;case"ssid":document.querySelector("#netName").innerHTML=n;break;case"hostname":document.querySelector("#hostname").innerHTML=n}}}else if("BAT"===t.slice(0,3)){console.log("BAT");let e=t.split('current":')[1].split(",")[0],n=JSON.parse(e);console.log(n),n>.2?document.querySelector("h1").classList.add("charging"):n<0?document.querySelector("h1").classList.add("discharging"):0==n&&(document.querySelector("h1").classList.remove("charging"),document.querySelector("h1").classList.remove("discharging"))}else if("CON"===t.slice(0,3)){console.log("CON");let e=t.split("--")[1],n=e.split("-passwd-")[0],o=e.split("-passwd-")[1];document.querySelector("#scanStations").innerHTML="Connected to "+n+"<br>with password : "+o}else console.log(t)}},C={};let P;C.exec=e=>{const t=e.data;if("SCN"===t.slice(0,3)){let e=t.slice(3);document.getElementById("scanStations").innerText="",console.log(JSON.parse(e));let n=JSON.parse(e);for(let t=0;t<n.length;t++){let e=document.createElement("div");e.setAttribute("label",n[t].ssid);let o=document.createElement("span");n[t].hidden?o.innerText="*(hidden)*":o.innerText=n[t].ssid,o.classList.add("ssid"),e.appendChild(o);let s=document.createElement("div");s.classList.add("params");let a=document.createElement("span");a.innerText=n[t].rssi+"dBm",s.appendChild(a);let r=document.createElement("span");r.innerText="ch:"+n[t].channel,s.appendChild(r);let c=document.createElement("span"),l="";switch(n[t].secure){case 2:l="TKIP";break;case 4:l="CCMP";break;case 5:l="WEP";break;case 7:l="NONE";break;case 8:l="AUTO";break;default:l="NO INFO"}c.innerText=l,s.appendChild(c),document.getElementById("scanStations").appendChild(e);let i=document.createElement("span");i.innerText=n[t].bssid,s.appendChild(i),e.appendChild(s),e.onclick=e=>{let t=e.target.parentElement.parentElement.getAttribute("label");t&&null!=t||(t=e.target.parentElement.getAttribute("label")),t&&null!=t||(t=e.target.getAttribute("label")),document.querySelector("#ssidInput").value=t,document.querySelector("#ssidPassword").focus(),console.log(t)}}}else console.log(t)},new Promise(((e,t)=>{B.init("bmsesp-db").then((t=>{console.log("db",t),e()}))})),document.querySelector("h1").innerText=window.location.pathname.split("/")[1].charAt(0).toUpperCase()+window.location.pathname.split("/")[1].slice(1);const q=["home.svg","cog.svg","wifi.svg","update.svg","menu.svg","terminal.svg"];function k(e){return new Promise(((t,n)=>{console.log(e),B.checkPublication(e,"bmsesp-db").then((n=>{n?B.loadPublication(e,"bmsesp-db").then((e=>{t(e)})):B.loadImage(e).then((n=>{n&&(""==n.blob.type&&"text/html"==n.blob.type||B.addPublication(e,"bmsesp-db",n.blob,n.b64).then((()=>{t(n)})))}))}))}))}async function A(e){return new Promise((function(t,n){console.log("======================= : ",e),k(e).then((e=>{var n=document.createElement("script");let o=e.blob;o.text().then((e=>{n.innerHTML=e})),n.async=!1,console.log(n),document.head.appendChild(n),t(o.text())}))}))}q.forEach(((e,t)=>{k(q[t]).then((e=>{let n=document.createElement("img");n.src=e.b64;let o=e.blob,s=e.b64;o.text().then((e=>console.log(s.length/e.length))),document.querySelector(`#glyph${t}`).appendChild(n)}))}));const j=["onIPMessage.js","initBatteryArray.js","btr2refrshlvlJs.js","onBTRMessage.js","onNetMessage.js"];var N=document.wSock;async function O(){return new Promise(((e,t)=>{(N=new WebSocket("ws://bmsesp2.local/ws")).onopen=t=>{console.log("WS opened"),console.log(t),e(N)},N.onclose=e=>{console.log("WS closed"),console.log(e),setTimeout(O,2e3)}}))}if("/"==window.location.pathname){let e=function(){return new Promise(((e,t)=>{A(j[1]).then((()=>{A(j[2]).then((()=>{initBatteryArray(4),A(j[3]).then((t=>e(t)))}))}))}))};console.log(window.location.pathname),document.querySelector("#card").innerHTML='\n    <div id="batteryArray" class="batteryArray"></div>\n        <div class="ntcsStats"></div>\n        <div class="batteryStats"></div> \n    ',O().then((t=>{e().then((()=>{N.send("ip"),N.send("batteryStatus");let e=document.querySelector("#chrgMosfetValue"),t=document.querySelector("#dsChrgMosfetValue");e.onclick=e=>{if(console.log(e.target),e.target.checked)N.send("MSFT--chr-true");else{confirm("are you shure?")&&N.send("MSFT--chr-false")}},t.onclick=e=>{if(console.log(e.target),e.target.checked)N.send("MSFT--dsc-true");else{confirm("are you shure?")&&N.send("MSFT--dsc-false")}}})),console.log(t),t.onmessage=e=>{if(console.log("WS message"),"BAT"===e.data.slice(0,3))onBTRMessage(e);else M.exec(e)},clearInterval(P),P=setInterval((()=>{t.send("batteryStatus")}),1300)}))}else if("/netscan"==window.location.pathname)O().then((e=>{N.send("netscan"),N.send("ip"),N.send("batteryStatus"),console.log(e),e.onmessage=e=>{if(console.log("WS message"),console.log(e.data.slice(0,3)),"SCN"===e.data.slice(0,3))C.exec(e);else M.exec(e)}})),document.querySelector("#card").innerHTML='\n    <p><button id="netscan" class="button">Scan</button></p>\n    <h2>Scaned Stations</h2>\n    <div id="scanStations" class="scanStations">\n    <span class="loader-89"></span>\n    </div>\n    <h4>Connect to network:</h4>\n    <div class="credentials">\n    <input id="ssidInput" type=\'text\' placeholder=\'network\' name=\'n\'/>\n    <hr /><input id="ssidPassword" type=\'password\' placeholder=\'password\' name=\'p\'/>\n    <hr /><button class="button" id="credits">Connect</button>\n    </div>\n    ',document.querySelector("#netscan").addEventListener("mousedown",(e=>{N.send("netscan"),document.querySelector("#scanStations").innerHTML="";let t=document.createElement("span");t.classList.add("loader-89"),document.querySelector("#scanStations").appendChild(t)})),document.querySelector("#credits").addEventListener("mousedown",(e=>{let t=document.querySelector("#ssidInput").value,n=document.querySelector("#ssidPassword").value;N.send("PWD--"+t+"-passwd-"+n),document.querySelector("#scanStations").innerHTML="";let o=document.createElement("span");o.classList.add("loader-89"),document.querySelector("#scanStations").appendChild(o)}));else if("/update"==window.location.pathname)O().then((e=>{e.send("ip"),e.send("batteryStatus"),console.log(e),e.onmessage=e=>{console.log("WS message"),console.log(e.data);e.data.slice(0,3);M.exec(e)}})),document.querySelector("#card").innerHTML='\n\n    <form method="POST" action="/update" enctype="multipart/form-data">\n    <input class="button" type="file" accept=".bin" name="update">\n    <input class="button" type="submit" value="Update"></form>';else if("/terminal"==window.location.pathname)O().then((e=>{e.send("ip"),e.send("batteryStatus"),console.log(e),e.onmessage=e=>{console.log("WS message"),console.log(e.data);e.data.slice(0,3);M.exec(e)}})),document.querySelector("#card").innerHTML='\n   <form method="POST" action="/update" enctype="multipart/form-data">\n    <input class="button" type="file" accept=".bin" name="update">\n    <input class="button" type="submit" value="Update"></form>';else if("/settings"==window.location.pathname){let e=function(e){console.log(e,e.length);for(let n=0;n<e.length;n++){const o=e[n],s=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];let a=document.createElement("div");a.setAttribute("class","row");let r=document.createElement("div");r.innerText=o.title,r.setAttribute("class","row__title");let c=document.createElement("div");c.innerText=o.b64.length,c.setAttribute("class","row__b64");let l=document.createElement("div");l.setAttribute("class","row__blob");let i=document.createElement("div");i.innerHTML=o.blob.type.split("/")[0]+"<br>"+o.blob.type.split("/")[1],i.setAttribute("class","row__blob__type");let d=document.createElement("div");d.innerText=o.blob.size,d.setAttribute("class","row__blob__size");let u=document.createElement("div"),m=new Date(o.dateModified);u.innerHTML=`${m.getDate()} ${s[m.getMonth()]} ${m.getFullYear()}<br>${m.getHours()}:${m.getMinutes()}:${m.getSeconds()}`,u.setAttribute("class","row__date"),a.appendChild(r),a.appendChild(c),l.appendChild(d),l.appendChild(i),a.appendChild(l),a.appendChild(u),a.childNodes.forEach((e=>e.childNodes.forEach((e=>e.ariaLabel="row-"+(n+1))))),a.childNodes.forEach((e=>e.ariaLabel="row-"+(n+1))),a.ariaLabel="row-"+(n+1),a.onmousedown=e=>{console.log(e.target.ariaLabel);let t=e.target.ariaLabel,n=document.querySelector(`#cashedElems > [aria-label=${t}]`),o=confirm("shure?");console.log(o),o&&(B.deletePublication("bmsesp-db",n.firstChild.innerText),console.log(n.firstChild.innerText),n.remove())},t.appendChild(a)}};O().then((e=>{N.send("ip"),N.send("batteryStatus"),console.log(e),e.onmessage=e=>{console.log("WS message");e.data.slice(0,3);M.exec(e)}})),document.querySelector("#card").innerHTML='\n    <p><button id="readCashed" class="button">Read Cashed Elems</button></p>\n    <div id="cashedElems">\n    </div>';const t=document.querySelector("#cashedElems");document.querySelector("#readCashed").addEventListener("mousedown",(n=>{t.innerHTML="",B.readAllDB("bmsesp-db").then((t=>{e(t)}))}))}else console.log(window.location.pathname),document.querySelector("#card").innerHTML='<div title="404">404</div>';
