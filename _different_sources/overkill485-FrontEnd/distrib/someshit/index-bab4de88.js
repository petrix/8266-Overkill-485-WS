!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const e=(e,t)=>t.some((t=>e instanceof t));let t,n;const o=new WeakMap,s=new WeakMap,a=new WeakMap,r=new WeakMap,l=new WeakMap;let c={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return s.get(e);if("objectStoreNames"===t)return e.objectStoreNames||a.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return m(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function i(e){c=e(c)}function d(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(p(this),t),m(o.get(this))}:function(...t){return m(e.apply(p(this),t))}:function(t,...n){const o=e.call(p(this),t,...n);return a.set(o,t.sort?t.sort():[t]),m(o)}}function u(n){return"function"==typeof n?d(n):(n instanceof IDBTransaction&&function(e){if(s.has(e))return;const t=new Promise(((t,n)=>{const o=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",a),e.removeEventListener("abort",a)},s=()=>{t(),o()},a=()=>{n(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",s),e.addEventListener("error",a),e.addEventListener("abort",a)}));s.set(e,t)}(n),e(n,t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(n,c):n)}function m(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const o=()=>{e.removeEventListener("success",s),e.removeEventListener("error",a)},s=()=>{t(m(e.result)),o()},a=()=>{n(e.error),o()};e.addEventListener("success",s),e.addEventListener("error",a)}));return t.then((t=>{t instanceof IDBCursor&&o.set(t,e)})).catch((()=>{})),l.set(t,e),t}(e);if(r.has(e))return r.get(e);const t=u(e);return t!==e&&(r.set(e,t),l.set(t,e)),t}const p=e=>l.get(e);function h(e,t,{blocked:n,upgrade:o,blocking:s,terminated:a}={}){const r=indexedDB.open(e,t),l=m(r);return o&&r.addEventListener("upgradeneeded",(e=>{o(m(r.result),e.oldVersion,e.newVersion,m(r.transaction),e)})),n&&r.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),l.then((e=>{a&&e.addEventListener("close",(()=>a())),s&&e.addEventListener("versionchange",(e=>s(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),l}const g=["get","getKey","getAll","getAllKeys","count"],b=["put","add","delete","clear"],f=new Map;function w(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(f.get(t))return f.get(t);const n=t.replace(/FromIndex$/,""),o=t!==n,s=b.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!s&&!g.includes(n))return;const a=async function(e,...t){const a=this.transaction(e,s?"readwrite":"readonly");let r=a.store;return o&&(r=r.index(t.shift())),(await Promise.all([r[n](...t),s&&a.done]))[0]};return f.set(t,a),a}i((e=>({...e,get:(t,n,o)=>w(t,n)||e.get(t,n,o),has:(t,n)=>!!w(t,n)||e.has(t,n)})));const y=["continue","continuePrimaryKey","advance"],S={},v=new WeakMap,T=new WeakMap,x={get(e,t){if(!y.includes(t))return e[t];let n=S[t];return n||(n=S[t]=function(...e){v.set(this,T.get(this)[t](...e))}),n}};async function*I(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;const n=new Proxy(t,x);for(T.set(n,t),l.set(n,p(t));t;)yield n,t=await(v.get(n)||t.continue()),v.delete(n)}function E(t,n){return n===Symbol.asyncIterator&&e(t,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===n&&e(t,[IDBIndex,IDBObjectStore])}i((e=>({...e,get:(t,n,o)=>E(t,n)?I:e.get(t,n,o),has:(t,n)=>E(t,n)||e.has(t,n)})));const M={};let L=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||self.indexedDB;var D;M.init=async e=>{console.log("DB-init",e),"indexedDB"in window?await D(e):console.log("This browser doesn't support IndexedDB")},D=async e=>await h(e,1,{upgrade(t){const n=t.createObjectStore(e,{keyPath:"title",autoIncrement:!0});n.createIndex("title","title",{unique:!0}),n.createIndex("b64","b64",{unique:!0}),n.createIndex("dateModified","dateModified",{unique:!1})}}),M.addPublication=async(e,t,n,o)=>{console.log(e,t,n);let s=await h(t,1);return await s.get(t,e)?(await s.put(t,{title:e,blob:n,b64:o,dateModified:(new Date).getTime()}),console.log("updated"),"updated"):(await s.add(t,{title:e,blob:n,b64:o,dateModified:(new Date).getTime()}),console.log("added"),"added")},M.loadPublication=async(e,t)=>{const n=await h(t,1);return await n.get(t,e)},M.checkPublication=async(e,t)=>{const n=await h(t,1);let o,s=n.transaction(t,"readonly");try{o=await s.objectStore(t).get(e)}catch{}return n.close(),o},M.loadImage=async e=>{const t=await async function(e){return console.log("function -loader - db "+e),new Promise(((t,n)=>{let o;try{o=fetch(e,{mode:"cors"}).then((e=>e.blob())),t(o)}catch(s){console.log(s)}finally{console.log("We do cleanup here")}}))}(`${e}`);console.log("recValue ",t);let n=t;return console.log(n),{title:e,blob:n,b64:await M.convToB64(n),dateModified:(new Date).getTime()}},M.readAllDB=async e=>{const t=await h(e,1),n=await t.getAll(e);return await t.getAllKeys(e),t.close(),n},M.deletePublication=async(e,t)=>{const n=await h(e,1);let o=n.transaction(e,"readwrite");try{await o.objectStore(e).get(t);o.objectStore(e).delete(t)}catch(s){}n.close()},M.deleteDatabase=e=>{L.open(e,1);var t=L.deleteDatabase(e);t.onsuccess=function(t){console.log("Database "+e+" deleted")},console.warn(t)},M.deleteObjStore=e=>{var t=M.getObjectStore(e,"readwrite");try{t.clear()}catch(n){}},M.bmpTOblob=e=>new Promise((t=>{const n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("bitmaprenderer").transferFromImageBitmap(e),n.toBlob((e=>t(e)))})),M.convToB64=function(e){return new Promise((t=>{let n=new FileReader;n.onload=function(){t(this.result)},n.readAsDataURL(e)}))};const B={exec:e=>{const t=e.data;if(console.log("IP Messages================================================"),"IP"===t.slice(0,2)){let e=t.split("--:")[1];console.log(e.split("-:"));let n=e.split("-:");for(const t of n){console.log(t.split(":-"));let e=t.split(":-")[0],n=t.split(":-")[1];switch(e){case"softap":document.querySelector("#softIP").innerHTML=n;break;case"local":document.querySelector("#pubIP").innerHTML=n;break;case"ssid":document.querySelector("#netName").innerHTML=n;break;case"hostname":document.querySelector("#hostname").innerHTML=`<a href="http://${n}.local">http://${n}.local</a>`}}}else if("BAT"===t.slice(0,3)){console.log("BAT");let e=t.split('current":')[1].split(",")[0],n=JSON.parse(e);console.log(n),n>.2?document.querySelector("h1").classList.add("charging"):n<0?document.querySelector("h1").classList.add("discharging"):0==n&&(document.querySelector("h1").classList.remove("charging"),document.querySelector("h1").classList.remove("discharging"))}else if("CON"===t.slice(0,3)){console.log("CON");let e=t.split("--")[1],n=e.split("-passwd-")[0],o=e.split("-passwd-")[1];document.querySelector("#scanStations").innerHTML="Connected to "+n+"<br>with password : "+o}else if("NCS"===t.slice(0,3)){console.log("NCS");let e=t.split("-:"),n=e[0].split(":-")[1],o=e[1].split(":-")[1],s=`http://${e[2].split(":-")[1]}.local`;document.querySelector("#scanStations").innerHTML=`Connected to ${n} with password : ${o}<br> hostname : ${s}`}else console.log(t)}},C={exec:e=>{const t=e.data;if("SCN"===t.slice(0,3)){let e=t.slice(3);document.getElementById("scanStations").innerText="",console.log(JSON.parse(e));let n=JSON.parse(e);for(let t=0;t<n.length;t++){let e=document.createElement("div");e.setAttribute("label",n[t].ssid);let o=document.createElement("span");n[t].hidden?o.innerText="*(hidden)*":o.innerText=n[t].ssid,o.classList.add("ssid"),e.appendChild(o);let s=document.createElement("div");s.classList.add("params");let a=document.createElement("span");a.innerText=n[t].rssi+"dBm",s.appendChild(a);let r=document.createElement("span");r.innerText="ch:"+n[t].channel,s.appendChild(r);let l=document.createElement("span"),c="";switch(n[t].secure){case 2:c="TKIP";break;case 4:c="CCMP";break;case 5:c="WEP";break;case 7:c="NONE";break;case 8:c="AUTO";break;default:c="NO INFO"}l.innerText=c,s.appendChild(l),document.getElementById("scanStations").appendChild(e);let i=document.createElement("span");i.innerText=n[t].bssid,s.appendChild(i),e.appendChild(s),e.onclick=e=>{let t=e.target.parentElement.parentElement.getAttribute("label");t&&null!=t||(t=e.target.parentElement.getAttribute("label")),t&&null!=t||(t=e.target.getAttribute("label")),document.querySelector("#ssidInput").value=t,document.querySelector("#ssidPassword").focus(),console.log(t)}}}else console.log(t)}},q={};let P;q.exec=e=>{const t=e.data;if("TRM"===t.slice(0,3)){let e=t.slice(5),n="",o=e.split("--")[0]+"000",s=e.split("--")[1],a=new Date(JSON.parse(o));console.log(a),n+=`${a.getHours()}:${a.getMinutes()}:${a.getSeconds()}`,n+=":",n+=s;const r=document.querySelector("#termFrame");let l=document.createElement("div");l.innerText=n,r.appendChild(l)}else console.log(t)},new Promise(((e,t)=>{M.init("bmsesp-db").then((t=>{console.log("db",t),e()}))})),document.querySelector("h1").innerText=window.location.pathname.split("/")[1].charAt(0).toUpperCase()+window.location.pathname.split("/")[1].slice(1);const k=["home.svg","cog.svg","wifi.svg","update.svg","terminal.svg","menu.svg","close.svg"];function A(e){return new Promise(((t,n)=>{console.log(e),M.checkPublication(e,"bmsesp-db").then((n=>{n?M.loadPublication(e,"bmsesp-db").then((e=>{t(e)})):M.loadImage(e).then((n=>{n&&(""==n.blob.type&&"text/html"==n.blob.type||M.addPublication(e,"bmsesp-db",n.blob,n.b64).then((()=>{t(n)})))}))}))}))}async function N(e){return new Promise((function(t,n){console.log("======================= : ",e),A(e).then((e=>{var n=document.createElement("script");let o=e.blob;o.text().then((e=>{n.innerHTML=e})),n.async=!1,console.log(n),document.head.appendChild(n),t(o.text())}))}))}k.forEach(((e,t)=>{A(k[t]).then((e=>{let n=document.createElement("img");n.src=e.b64;let o=e.blob,s=e.b64;o.text().then((e=>console.log(s.length/e.length))),document.querySelector(`#glyph${t}`).appendChild(n)}))}));const j=["onIPMessage.js","initBatteryArray.js","btr2refrshlvlJs.js","onBTRMessage.js","onTermMessage.js"];let O;var $="ws://"+window.location.hostname+"/ws";async function H(){return new Promise(((e,t)=>{O=new WebSocket($),O.onopen=t=>{console.log("WS opened"),console.log(t),document.websocket=O,e(O)},O.onclose=e=>{console.log("WS closed"),console.log(e),setTimeout(H,2e3)}}))}if("/"==window.location.pathname){let e=function(){return new Promise(((e,t)=>{N(j[1]).then((()=>{N(j[2]).then((()=>{initBatteryArray(4),N(j[3]).then((t=>e(t)))}))}))}))};console.log(window.location.pathname),document.querySelector("#card").innerHTML='\n    <div id="batteryArray" class="batteryArray"></div>\n        <div class="ntcsStats"></div>\n        <div class="batteryStats"></div> \n    ',H().then((t=>{e().then((()=>{O.send("ip"),O.send("batteryStatus");let e=document.querySelector("#chrgMosfetValue"),t=document.querySelector("#dsChrgMosfetValue");e.onclick=e=>{if(console.log(e.target),e.target.checked)O.send("MSFT--chr-true");else{confirm("are you shure?")&&O.send("MSFT--chr-false")}},t.onclick=e=>{if(console.log(e.target),e.target.checked)O.send("MSFT--dsc-true");else{confirm("are you shure?")&&O.send("MSFT--dsc-false")}}})),console.log(t),t.onmessage=e=>{if(console.log("WS message"),"BAT"===e.data.slice(0,3))onBTRMessage(e);else B.exec(e)},clearInterval(P),P=setInterval((()=>{t.send("batteryStatus")}),1300)}))}else if("/netscan"==window.location.pathname){let e;H().then((e=>{O.send("netscan"),O.send("ip"),O.send("batteryStatus"),console.log(e),e.onmessage=e=>{if(console.log("WS message"),console.log(e.data.slice(0,3)),"SCN"===e.data.slice(0,3))C.exec(e);else B.exec(e)}}));let t=document.querySelector("#hostname > a").href;if(t.split("://").length>1){e=t.split("://")[1].split(".local")[0]}e||(e=`bms-${(1e3*Math.random()).toFixed(0)}`),document.querySelector("#card").innerHTML=`\n    <p><button id="netscan" class="button">Scan</button></p>\n    <h2>Scaned Stations</h2>\n    <div id="scanStations" class="scanStations">\n    <span class="loader-89"></span>\n    </div>\n    <h4>Connect to network:</h4>\n    <div class="credentials">\n    <div>\n    <span>SSID:</span><input id="ssidInput" type='text' placeholder='network' name='n'/>\n    </div>\n    <hr />\n<div>\n<span>PASS:</span><input id="ssidPassword" type='password' placeholder='password' name='p'/>\n</div>\n    <hr />\n    <div>\n    <span>http://</span><input id="hostName" type='text' value ='${e}' placeholder='hostname' name='h'/><span>.local</span>\n    </div>\n    <hr /><button class="button" id="credits">Connect</button>\n    </div>\n    `,document.querySelector("#netscan").addEventListener("mousedown",(e=>{O.send("netscan"),document.querySelector("#scanStations").innerHTML="";let t=document.createElement("span");t.classList.add("loader-89"),document.querySelector("#scanStations").appendChild(t)})),document.querySelector("#credits").addEventListener("mousedown",(e=>{let t=document.querySelector("#ssidInput").value,n=document.querySelector("#ssidPassword").value,o=document.querySelector("#hostName").value;O.send("PWD--"+t+"::"+n+"::"+o),document.querySelector("#scanStations").innerHTML="";let s=document.createElement("span");s.classList.add("loader-89"),document.querySelector("#scanStations").appendChild(s)}))}else if("/update"==window.location.pathname){let e=function(){requestAnimationFrame(e),n.clearRect(0,0,t.width,t.height),n.textAlign="center",n.font="100px MMD",n.textBaseline="middle",n.imageSmoothingQuality="high",n.fillStyle="#fff",n.fillText(((performance.now()-o)/1e3).toFixed(1),t.width/2,t.height/2)};H().then((e=>{e.send("ip"),e.send("batteryStatus"),console.log(e),e.onmessage=e=>{console.log("WS message"),console.log(e.data);e.data.slice(0,3);B.exec(e)}})),document.querySelector("#card").innerHTML='\n    <form method="POST" action="/update" enctype="multipart/form-data">\n    <input class="button" type="file" accept=".bin" name="update">\n    <input class="button" type="submit" value="Update"></form>\n    ';let t=document.createElement("canvas");t.width="500",t.height="200";let n=t.getContext("2d");document.querySelector("body > div.content").appendChild(t);let o=performance.now();document.querySelector("#card > form > input:nth-child(2)").onmousedown=t=>{e(),o=performance.now(),console.log(t.target)}}else if("/terminal"==window.location.pathname)document.querySelector("#card").innerHTML='\n   <div id="terminalWindow">\n   <div id="termFrame"></div>\n   </div>',H().then((e=>{e.send("ip"),e.send("batteryStatus"),e.send("terminal"),console.log(e),e.onmessage=e=>{switch(console.log("WS message"),console.log(e.data),e.data.slice(0,3)){case"IP-":default:B.exec(e);break;case"TRM":q.exec(e)}}}));else if("/settings"==window.location.pathname){let e=function(e){console.log(e,e.length);for(let n=0;n<e.length;n++){const o=e[n],s=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];let a=document.createElement("div");a.setAttribute("class","row");let r=document.createElement("div");r.innerText=o.title,r.setAttribute("class","row__title");let l=document.createElement("div");l.innerText=o.b64.length,l.setAttribute("class","row__b64");let c=document.createElement("div");c.setAttribute("class","row__blob");let i=document.createElement("div");i.innerHTML=o.blob.type.split("/")[0]+"<br>"+o.blob.type.split("/")[1],i.setAttribute("class","row__blob__type");let d=document.createElement("div");d.innerText=o.blob.size,d.setAttribute("class","row__blob__size");let u=document.createElement("div"),m=new Date(o.dateModified);u.innerHTML=`${m.getDate()} ${s[m.getMonth()]} ${m.getFullYear()}<br>${m.getHours()}:${m.getMinutes()}:${m.getSeconds()}`,u.setAttribute("class","row__date"),a.appendChild(r),a.appendChild(l),c.appendChild(d),c.appendChild(i),a.appendChild(c),a.appendChild(u),a.childNodes.forEach((e=>e.childNodes.forEach((e=>e.ariaLabel="row-"+(n+1))))),a.childNodes.forEach((e=>e.ariaLabel="row-"+(n+1))),a.ariaLabel="row-"+(n+1),a.onmousedown=e=>{console.log(e.target.ariaLabel);let t=e.target.ariaLabel,n=document.querySelector(`#cashedElems > [aria-label=${t}]`),o=confirm("shure?");console.log(o),o&&(M.deletePublication("bmsesp-db",n.firstChild.innerText),console.log(n.firstChild.innerText),n.remove())},t.appendChild(a)}};H().then((e=>{O.send("ip"),O.send("batteryStatus"),console.log(e),e.onmessage=e=>{console.log("WS message");e.data.slice(0,3);B.exec(e)}})),document.querySelector("#card").innerHTML='\n    <p><button id="readCashed" class="button">Read Cashed Elems</button></p>\n    <div id="cashedElems">\n    </div>';const t=document.querySelector("#cashedElems");document.querySelector("#readCashed").addEventListener("mousedown",(n=>{t.innerHTML="",M.readAllDB("bmsesp-db").then((t=>{e(t)}))}))}else console.log(window.location.pathname),document.querySelector("#card").innerHTML='<div title="404">404</div>';
