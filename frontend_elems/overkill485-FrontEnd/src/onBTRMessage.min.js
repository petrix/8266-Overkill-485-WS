const onBTRMessage=e=>{const t=e.data;if("BAT"===t.slice(0,3)){const e=t.slice(3),r=JSON.parse(e);if(batteryObj=r[0],console.log(batteryObj),batteryObj.cellsVoltage){let e=0;batteryObj.cellsVoltage.forEach((t,r)=>{let a=t-3;refreshLevel(r,a/1.15,t),e+=t});let t=document.querySelectorAll(".cell");batteryObj.cellsBalance.forEach((e,r)=>{e?t[r].querySelector(".battery").classList.add("balancing"):t[r].querySelector(".battery").classList.remove("balancing")}),console.log(e.toFixed(3));const r=document.btrSt;r.cellSum.value.innerHTML=e.toFixed(3)+" v",r.balanceCap.value.innerHTML=batteryObj.BalanceCapacity+" ah",r.rateCap.value.innerHTML=batteryObj.RateCapacity+" ah",r.divVoltage.value.innerHTML=batteryObj.voltage+" v",r.divCurrent.value.innerHTML=batteryObj.current+" a",batteryObj.current<0?(r.divInputPower.value.innerHTML="0 w",r.divOutputPower.value.innerHTML=(batteryObj.voltage*Math.abs(batteryObj.current)).toFixed(2)+" w"):batteryObj.current>0?(r.divInputPower.value.innerHTML=(batteryObj.voltage*batteryObj.current).toFixed(2)+" w",r.divOutputPower.value.innerHTML="0 w"):(r.divInputPower.value.innerHTML="0 w",r.divOutputPower.value.innerHTML="0 w"),r.divVoltDiff.value.innerHTML=(Math.max.apply(null,batteryObj.cellsVoltage)-Math.min.apply(null,batteryObj.cellsVoltage)).toFixed(3)+" v",document.querySelector("#chrgMosfetValue").checked=batteryObj.chargeMosfet,document.querySelector("#dsChrgMosfetValue").checked=batteryObj.dischargeMosfet,r.stateChrg.value.innerHTML=batteryObj.stateOfCharge+" %",document.querySelector("body > div.content > div > div.ntcsStats").childNodes.forEach((e,t)=>{e.innerHTML=batteryObj.ntcs[t]+"&#176;C"})}let a=new Date(parseInt(batteryObj.currentTime+"000")),c=a.getHours();c<10&&(c="0"+c);let l=a.getMinutes();l<10&&(l="0"+l);let n=a.getSeconds();n<10&&(n="0"+n);const o=document.btrSt;o.currentTime.value.innerHTML=`${c}:${l}:${n}`,batteryObj.current>0?(document.querySelector("h1").innerHTML="CHARGING!!!",document.querySelectorAll(".acid-container > .acid").forEach(e=>{e.style.filter="hue-rotate(222deg)",document.querySelector("h1").classList.add("charging"),document.querySelector("h1").classList.remove("discharging")})):batteryObj.current<0?(document.querySelector("h1").innerHTML="DISCHARGING!!!",document.querySelectorAll(".acid-container > .acid").forEach(e=>{e.style.filter="hue-rotate(0deg)",document.querySelector("h1").classList.remove("charging"),document.querySelector("h1").classList.add("discharging")})):(document.querySelector("h1").classList.remove("discharging"),document.querySelector("h1").classList.remove("charging"),document.querySelector("h1").innerHTML="..idle",document.querySelectorAll(".acid-container > .acid").forEach(e=>{e.style.filter="hue-rotate(120deg)"}))}else console.log(t)};